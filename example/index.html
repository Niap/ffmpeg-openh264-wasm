<html>
  <head>
    <style>
      html, body {
        margin: 0;
        width: 100%;
        height: 100%
      }
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <h3>Upload a video to transcode to mp4 (x264) and play!</h3>
    <input type="file" id="uploader">
    <img id="output-image" />
    <img id="cover-image" />
    <audio id="output-audio" controls></audio>
    <video id="output-video" controls></video>
    <script type="text/javascript">
     const readFromBlobOrFile = (blob) => (
        new Promise((resolve, reject) => {
          const fileReader = new FileReader();
          fileReader.onload = () => {
            resolve(fileReader.result);
          };
          fileReader.onerror = ({ target: { error: { code } } }) => {
            reject(Error(`File could not be read! Code=${code}`));
          };
          fileReader.readAsArrayBuffer(blob);
        })
    );

      const ffmpegWorker = new Worker("worker.js");
    
      ffmpegWorker.onmessage = (e)=>{
        const videoDom = document.getElementById('output-video');
        videoDom.src = URL.createObjectURL(new Blob([e.data], { type: 'video/mp4' }));
      }

      const onFileSelected = async ({target: { files }})=>{

        const data = new Uint8Array(await readFromBlobOrFile(files[0]));
        ffmpegWorker.postMessage(data);
      }
      document.getElementById('uploader').addEventListener('change', onFileSelected);
    </script>
    <script type="text/javascript" src="./ffmpeg-core.js"></script>
  </body>
</html>
